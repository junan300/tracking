<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.jsdelivr.net; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.jsdelivr.net;">
    <title>Goal Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        #root {
            max-width: 1200px;
            margin: 0 auto;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .goal-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .goal-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .goal-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .goal-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: #2d3748;
        }

        .goal-time {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .goal-label {
            font-size: 0.875rem;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .add-time-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 12px;
        }

        .add-time-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .add-time-btn:active {
            transform: scale(0.98);
        }

        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
        }

        .control-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #4a5568;
        }

        .control-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .emoji {
            font-size: 1.5rem;
            margin-right: 8px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .goal-card {
            animation: slideIn 0.5s ease;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const GOAL_PRESETS = [
            { id: 1, name: 'Deep Work', emoji: 'üéØ', color: '#667eea' },
            { id: 2, name: 'Exercise', emoji: 'üí™', color: '#48bb78' },
            { id: 3, name: 'Learning', emoji: 'üìö', color: '#ed8936' },
            { id: 4, name: 'Creative', emoji: 'üé®', color: '#9f7aea' },
            { id: 5, name: 'Social', emoji: 'ü§ù', color: '#38b2ac' }
        ];

        function App() {
            const [goals, setGoals] = useState(() => {
                const saved = localStorage.getItem('goals');
                return saved ? JSON.parse(saved) : GOAL_PRESETS.map(g => ({ ...g, hours: 0 }));
            });
            
            const [activeGoal, setActiveGoal] = useState(null);
            const chartInstanceRef = useRef(null);

            const addHour = (goalId) => {
                setGoals(goals.map(g => 
                    g.id === goalId ? { ...g, hours: g.hours + 1 } : g
                ));
                setActiveGoal(goalId);
                setTimeout(() => setActiveGoal(null), 300);
            };

            const resetData = () => {
                if (confirm('Reset all progress?')) {
                    setGoals(GOAL_PRESETS.map(g => ({ ...g, hours: 0 })));
                }
            };

            const updateChart = () => {
                const ctx = document.getElementById('progressChart');
                if (!ctx) return;

                // Destroy existing chart if it exists
                if (chartInstanceRef.current) {
                    chartInstanceRef.current.destroy();
                    chartInstanceRef.current = null;
                }

                // Also check if Chart.js has already registered a chart on this canvas
                const existingChart = Chart.getChart(ctx);
                if (existingChart) {
                    existingChart.destroy();
                }

                const newChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: goals.map(g => g.name),
                        datasets: [{
                            data: goals.map(g => g.hours || 0.1),
                            backgroundColor: goals.map(g => g.color),
                            borderWidth: 0,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: {
                                        size: 14,
                                        family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const hours = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((hours / total) * 100).toFixed(1);
                                        return `${context.label}: ${hours}h (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        animation: {
                            animateScale: true,
                            animateRotate: true
                        }
                    }
                });

                chartInstanceRef.current = newChart;
            };

            useEffect(() => {
                localStorage.setItem('goals', JSON.stringify(goals));
                updateChart();
                
                return () => {
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                        chartInstanceRef.current = null;
                    }
                };
            }, [goals]);

            const totalHours = goals.reduce((sum, g) => sum + g.hours, 0);

            return (
                <div className="container">
                    <h1>‚è∞ Goal Tracker</h1>
                    <p className="subtitle">Track your time, achieve your goals</p>
                    
                    <div className="controls">
                        <button className="control-btn" onClick={resetData}>
                            üîÑ Reset All
                        </button>
                        <button className="control-btn" onClick={() => {
                            const data = JSON.stringify(goals, null, 2);
                            const blob = new Blob([data], { type: 'application/json' });
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = 'goal-tracker-data.json';
                            a.click();
                        }}>
                            üíæ Export Data
                        </button>
                    </div>

                    <div className="goals-grid">
                        {goals.map(goal => (
                            <div 
                                key={goal.id} 
                                className={`goal-card ${activeGoal === goal.id ? 'active' : ''}`}
                            >
                                <div className="goal-header">
                                    <span className="emoji">{goal.emoji}</span>
                                    <span className="goal-name">{goal.name}</span>
                                </div>
                                <div className="goal-time">{goal.hours}h</div>
                                <div className="goal-label">Total Time</div>
                                <button 
                                    className="add-time-btn"
                                    onClick={() => addHour(goal.id)}
                                >
                                    + 1 Hour
                                </button>
                            </div>
                        ))}
                    </div>

                    <div className="chart-container">
                        <h2 className="chart-title">üìä Time Distribution</h2>
                        <div style={{ maxWidth: '500px', margin: '0 auto' }}>
                            <canvas id="progressChart"></canvas>
                        </div>
                        {totalHours > 0 && (
                            <div style={{ textAlign: 'center', marginTop: '20px', color: '#718096' }}>
                                Total tracked: <strong style={{ color: '#667eea' }}>{totalHours} hours</strong>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
